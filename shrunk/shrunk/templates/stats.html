{% extends "base.html" %}
{% block content %}

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://cdn.plot.ly/plotly-1.48.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.js"></script>
<script src="https://cdn.jsdelivr.net/gh/emn178/chartjs-plugin-labels/src/chartjs-plugin-labels.js"></script>

<div class="row row-controls">
  <div class="col col-auto">
    <h2 style="display: inline-block">Visit statistics for <em>{{ short_url }}</em></h2>
  </div>

  <div class="col">
    <form action="/link-visits-csv">
      <input type="hidden" name="url" value="{{ short_url }}">
      <button type="submit"
	      class="btn btn-outline-primary btn-no-border btn-no-background btn-csv-download bg-light">
	<i class="fas fa-download"></i> Export visit data as CSV
      </button>
    </form>
  </div>
</div>

<div class="row">
  <div class="col">
    <h3><a href="{{ url_info['long_url'] }}">{{ url_info["title"] }}</a></h3>
      <span style="margin-right: 10px">Total visits: {{ url_info["visits"] }}</span>
      <span>First time visits: <span id="first_time_visits">Loading...</span></span>

      <div id="visits-container" style="min-width 310px; height: 400px; margin: 0 auto"></div>
    </ul>
  </div>
</div>

<hr>

<div class="row">
  <div class="col">
    <div id="map-toggle" class="btn-group">
      <button class="btn btn-default" type="button" onmouseup="show_us_map()">US</button>
      <button class="btn btn-default" type="button" onmouseup="show_world_map()">World</button>
    </div>

    <div id="maps-div">
      <div id="us-map"></div>
      <div id="world-map"></div>
    </div>
  </div>
</div>

<hr>

<div class="row">
  <div class="col">
    <div class="pie-div" height="191" id="browser-stats">
      <canvas id="browser-canvas"></canvas>
    </div>
  </div>

  <div class="col">
    <div class="pie-div" id="platform-stats">
      <canvas id="platform-canvas"></canvas>
    </div>
  </div>

  <div class="col">
    <div class="pie-div" id="referer-stats">
      <canvas id="referer-canvas"></canvas>
    </div>
  </div>
</div>

{% assets "shrunk_stats" %}
<script src="{{ ASSET_URL }}"></script>
{% endassets %}

{% endblock %}
