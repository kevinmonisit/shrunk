{% extends "base.html" %}
{% block content %}

<link href="{{ url_for('static', filename='css/index.css') }}" rel="stylesheet">

{% if wrong_owner %}
<div class="shrunk-messages">
    You are not the owner of this URL...
</div>
{% endif %}

<div class="row row-controls">
  <div class="col col-md-auto">
    <h2>URL Dashboard</h2>
  </div>

  <div class="col col-md-auto">
    <form action="/add">
      <button type="submit" class="btn btn-primary">
	<i class="fas fa-plus-circle"></i> New Link
      </button>
    </form>
  </div>

  <!-- The sort dropdown (really ugly) -->
  <div class="col col-md-auto">
    <div class="dropdown">
      <button class="btn btn-outline-primary dropdown-toggle btn-no-border btn-no-background bg-light"
	      type="button" data-toggle="dropdown"
	      aria-haspopup="true" aria-expanded="false">
	{% if sortby == "0" %}
	Newest first
	{% elif sortby == "1" %}
	Oldest first
	{% elif sortby == "2" %}
	A-Z
	{% elif sortby == "3" %}
	Z-A
	{% elif sortby == "4" %}
	Increasing visits
	{% elif sortby == "5" %}
	Decreasing visits
	{% endif %}
      </button>
      <div class="dropdown-menu">
	<a class="dropdown-item" href="javascript:requery('0')">Newest first</a>
	<a class="dropdown-item" href="javascript:requery('1')">Oldest first</a>
	<a class="dropdown-item" href="javascript:requery('2')">A-Z</a>
	<a class="dropdown-item" href="javascript:requery('3')">Z-A</a>
	<a class="dropdown-item" href="javascript:requery('4')">Increasing visits</a>
	<a class="dropdown-item" href="javascript:requery('5')">Decreasing visits</a>
      </div>
    </div>
  </div> <!-- End col -->

  <!-- The my links/all links dropdown (ugly again) -->
  {% if admin %}
  <div class="col col-md-auto">
    <div class="dropdown">
      <button class="btn btn-outline-primary btn-no-border btn-no-background dropdown-toggle bg-light"
	      type="button" data-toggle="dropdown"
	      aria-haspopup="true" aria-expanded="false">
	{% if all_users == "0" %}
	View my links
	{% elif all_users == "1" %}
	View all links
	{% endif %}
      </button>
      <div class="dropdown-menu">
	<a class="dropdown-item" href="javascript:requery_au('0')">View my links</a>
	<a class="dropdown-item" href="javascript:requery_au('1')">View all links</a>
      </div>
    </div>
  </div> <!-- End col -->
  {% endif %}

  <div class="col col-csv-download">
    <form action="/search-visits-csv?all_users={{ all_users }}&search={{ query }}">
      <button type="submit"
	      class="btn btn-outline-primary btn-no-border btn-no-background btn-csv-download bg-light">
	<i class="fas fa-download"></i> Export visit data as CSV
      </button>
    </form>
  </div> <!-- End col -->
</div> <!-- End row -->

{% if query and not links %}
<div class="row">
  <div class="col">
    <div class="shrunk-messages">
      No results found for query <strong>{{ query }}</strong>
    </div>
  </div>
</div>
{% endif %}

{% if links %}
<div class="container">
  {% for link in links %}
  {% include "link_card.html" %}
  {% endfor %}
</div> <!-- End container -->

{% if lastpage and lastpage > 1 %}
<nav aria-label="Search results pages">
  <ul class="pagination justify-content-center">
    <li class="page-item {{ 'disabled' if page == 1 else '' }}">
      <a class="page-link" aria-label="Previous"
	 href="{{ url_for('render_index', p=page-1, search=query) }}">
	<span aria-hidden="true">&laquo;</span>
	<span class="sr-only">Previous</span>
      </a>
    </li> <!-- End previous button -->

    {% if begin_pages != 1 %}
    <li class="page-item">
      <a class="page-link" aria-label="Page 1"
	 href="{{ url_for('render_index', p=1, search=query) }}">
	1
      </a>
    </li>

    <li class="page-item disabled">
      <a class="page-link" aria-label="Ellipsis">
	...
      </a>
    </li>
    {% endif %}

    {% for page_number in range(begin_pages, end_pages+1) %}
    {% set maybe_active = 'active' if page_number == page else '' %}
    <li class="page-item {{ maybe_active }}">
      <a class="page-link" aria-label="Page {{ page_number }}"
	 href="{{ url_for('render_index', p=page_number, search=query) }}">
	{{ page_number }}
      </a>
    </li>
    {% endfor %}

    {% if end_pages != lastpage %}
    <li class="page-item disabled">
      <a class="page-link" aria-label="Ellipsis">
	...
      </a>
    </li>

    <li class="page-time">
      <a class="page-link" aria-label="Page {{ lastpage }}"
	 href="{{ url_for('render_index', p=lastpage, search=query) }}">
	{{ lastpage }}
      </a>
    </li>
    {% endif %}

    <li class="page-item {{ 'disabled' if page == lastpage else '' }}">
      <a class="page-link" aria-label="Next"
	 href="{{ url_for('render_index', p=page+1, search=query) }}">
	<span aria-hidden"true">&raquo;</span>
	<span class="sr-only">Next</span>
      </a>
    </li> <!-- End next button -->
  </ul>
</nav>
{% endif %}

{% endif %}

{% endblock %}
