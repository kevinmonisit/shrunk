{% extends "base.html" %}
{% block content %}

{% if wrong_owner %}
<div class="shrunk-messages">
    You are not the owner of this URL...
</div>
{% endif %}

<div class="row row-controls">
  <div class="col col-md-auto">
    <h2>URL Dashboard</h2>
  </div>

  {# Add Link dropdown menu #}
  <div class="col col-md-auto">
    <div class="dropdown">
      <button type="button" class="btn btn-primary dropdown-toggle"
	 data-toggle="dropdown" aria-expanded="false" onclick="clear_add_link_form()">
	<i class="fas fa-plus-circle"></i> Add Link
      </button>

      <div class="dropdown-menu create-org-dropdown">
	<form class="px-4 py-3 needs-validation" novalidate>
	  <div class="form-group row">
	    <input type="text" id="add-link-title" class="form-control" placeholder="Title">
	    <div id="add-link-title-feedback" class="invalid-feedback"></div>
	  </div>
	  <div class="form-group row">
	    <input type="text" id="add-link-long_url" class="form-control" placeholder="URL">
	    <div id="add-link-long_url-feedback" class="invalid-feedback"></div>
	  </div>
	  <div class="form-group row">
	    <input type="text" id="add-link-short_url" class="form-control"
		   placeholder="Alias (optional)">
	    <div id="add-link-short_url-feedback" class="invalid-feedback"></div>
	  </div>
	  <button id="add-link-button" class="btn btn-primary" type="button"
		  onclick="send_add_request()">
	    Shrink
	  </button>
	</form>
      </div>
    </div>
  </div>

  {# Sort dropdown menu #}
  <div class="col col-md-auto">
    <div class="dropdown">
      <button class="btn btn-outline-primary dropdown-toggle btn-no-border btn-no-background bg-light"
	      type="button" data-toggle="dropdown"
	      aria-haspopup="true" aria-expanded="false">
	{% if sortby == "0" %}
	Newest first
	{% elif sortby == "1" %}
	Oldest first
	{% elif sortby == "2" %}
	A-Z
	{% elif sortby == "3" %}
	Z-A
	{% elif sortby == "4" %}
	Increasing visits
	{% elif sortby == "5" %}
	Decreasing visits
	{% endif %}
      </button>
      <div class="dropdown-menu">
	<a class="dropdown-item" href="javascript:change_sortby('0')">Newest first</a>
	<a class="dropdown-item" href="javascript:change_sortby('1')">Oldest first</a>
	<a class="dropdown-item" href="javascript:change_sortby('2')">A-Z</a>
	<a class="dropdown-item" href="javascript:change_sortby('3')">Z-A</a>
	<a class="dropdown-item" href="javascript:change_sortby('4')">Increasing visits</a>
	<a class="dropdown-item" href="javascript:change_sortby('5')">Decreasing visits</a>
      </div>
    </div>
  </div>

  {# My Links/All Links dropdown menu #}
  {% if "admin" in roles %}
  <div class="col col-md-auto">
    <div class="dropdown">
      <button class="btn btn-outline-primary btn-no-border btn-no-background dropdown-toggle bg-light"
	      type="button" data-toggle="dropdown"
	      aria-haspopup="true" aria-expanded="false">
	{% if all_users == "0" %}
	View my links
	{% elif all_users == "1" %}
	View all links
	{% endif %}
      </button>
      <div class="dropdown-menu">
	<a class="dropdown-item" href="javascript:change_all_users('0')">View my links</a>
	<a class="dropdown-item" href="javascript:change_all_users('1')">View all links</a>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="col col-csv-download">
    <form action="/search-visits-csv?all_users={{ all_users }}&search={{ query }}">
      <button type="submit"
	      class="btn btn-outline-primary btn-no-border btn-no-background btn-csv-download bg-light">
	<i class="fas fa-download"></i> Export visit data as CSV
      </button>
    </form>
  </div>
</div>

{% if query and not links %}
<div class="row">
  <div class="col">
    <div class="shrunk-messages">
      No results found for query <strong>{{ query }}</strong>
    </div>
  </div>
</div>
{% endif %}

{% if links %}
<div class="container">
  {% for link in links %}
  {% include "link_card.html" %}
  {% endfor %}
</div>

{% if lastpage and lastpage > 1 %}
<nav aria-label="Search results pages">
  <ul class="pagination justify-content-center">
    <li class="page-item {{ 'disabled' if page == 1 else '' }}">
      <a class="page-link" aria-label="Previous"
	 href="{{ url_for('render_index', page=page-1) }}">
	<span aria-hidden="true">&laquo;</span>
	<span class="sr-only">Previous</span>
      </a>
    </li>

    {% if begin_pages != 1 %}
    <li class="page-item">
      <a class="page-link" aria-label="Page 1"
	 href="{{ url_for('render_index', page=1) }}">
	1
      </a>
    </li>

    <li class="page-item disabled">
      <a class="page-link" aria-label="Ellipsis">
	...
      </a>
    </li>
    {% endif %}

    {% for page_number in range(begin_pages, end_pages+1) %}
    {% set maybe_active = 'active' if page_number == page else '' %}
    <li class="page-item {{ maybe_active }}">
      <a class="page-link" aria-label="Page {{ page_number }}"
	 href="{{ url_for('render_index', page=page_number) }}">
	{{ page_number }}
      </a>
    </li>
    {% endfor %}

    {% if end_pages != lastpage %}
    <li class="page-item disabled">
      <a class="page-link" aria-label="Ellipsis">
	...
      </a>
    </li>

    <li class="page-time">
      <a class="page-link" aria-label="Page {{ lastpage }}"
	 href="{{ url_for('render_index', page=lastpage) }}">
	{{ lastpage }}
      </a>
    </li>
    {% endif %}

    <li class="page-item {{ 'disabled' if page == lastpage else '' }}">
      <a class="page-link" aria-label="Next"
	 href="{{ url_for('render_index', page=page+1) }}">
	<span aria-hidden="true">&raquo;</span>
	<span class="sr-only">Next</span>
      </a>
    </li>
  </ul>
</nav>
{% endif %}

{% endif %}

{% assets "shrunk_index" %}
<script src="{{ ASSET_URL }}"></script>
{% endassets %}

{% endblock %}
